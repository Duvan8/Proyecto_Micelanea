<<<<<<< HEAD
var path = require('path')
var fs = require('graceful-fs')
var mkdir = require('../mkdirs')

function createLink (srcpath, dstpath, callback) {
  function makeLink (srcpath, dstpath) {
    fs.link(srcpath, dstpath, function (err) {
=======
'use strict'

const u = require('universalify').fromCallback
const path = require('path')
const fs = require('graceful-fs')
const mkdir = require('../mkdirs')
const pathExists = require('../path-exists').pathExists

function createLink (srcpath, dstpath, callback) {
  function makeLink (srcpath, dstpath) {
    fs.link(srcpath, dstpath, err => {
>>>>>>> 32ba16e633ba9db23718e793ab28964a39fd3732
      if (err) return callback(err)
      callback(null)
    })
  }

<<<<<<< HEAD
  fs.exists(dstpath, function (destinationExists) {
    if (destinationExists) return callback(null)
    fs.lstat(srcpath, function (err, stat) {
=======
  pathExists(dstpath, (err, destinationExists) => {
    if (err) return callback(err)
    if (destinationExists) return callback(null)
    fs.lstat(srcpath, (err) => {
>>>>>>> 32ba16e633ba9db23718e793ab28964a39fd3732
      if (err) {
        err.message = err.message.replace('lstat', 'ensureLink')
        return callback(err)
      }

<<<<<<< HEAD
      var dir = path.dirname(dstpath)
      fs.exists(dir, function (dirExists) {
        if (dirExists) return makeLink(srcpath, dstpath)
        mkdir.mkdirs(dir, function (err) {
=======
      const dir = path.dirname(dstpath)
      pathExists(dir, (err, dirExists) => {
        if (err) return callback(err)
        if (dirExists) return makeLink(srcpath, dstpath)
        mkdir.mkdirs(dir, err => {
>>>>>>> 32ba16e633ba9db23718e793ab28964a39fd3732
          if (err) return callback(err)
          makeLink(srcpath, dstpath)
        })
      })
    })
  })
}

<<<<<<< HEAD
function createLinkSync (srcpath, dstpath, callback) {
  var destinationExists = fs.existsSync(dstpath)
=======
function createLinkSync (srcpath, dstpath) {
  const destinationExists = fs.existsSync(dstpath)
>>>>>>> 32ba16e633ba9db23718e793ab28964a39fd3732
  if (destinationExists) return undefined

  try {
    fs.lstatSync(srcpath)
  } catch (err) {
    err.message = err.message.replace('lstat', 'ensureLink')
    throw err
  }

<<<<<<< HEAD
  var dir = path.dirname(dstpath)
  var dirExists = fs.existsSync(dir)
=======
  const dir = path.dirname(dstpath)
  const dirExists = fs.existsSync(dir)
>>>>>>> 32ba16e633ba9db23718e793ab28964a39fd3732
  if (dirExists) return fs.linkSync(srcpath, dstpath)
  mkdir.mkdirsSync(dir)

  return fs.linkSync(srcpath, dstpath)
}

module.exports = {
<<<<<<< HEAD
  createLink: createLink,
  createLinkSync: createLinkSync,
  // alias
  ensureLink: createLink,
  ensureLinkSync: createLinkSync
=======
  createLink: u(createLink),
  createLinkSync
>>>>>>> 32ba16e633ba9db23718e793ab28964a39fd3732
}
